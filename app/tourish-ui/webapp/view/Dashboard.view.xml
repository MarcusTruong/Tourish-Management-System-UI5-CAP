<mvc:View
    controllerName="tourishui.controller.Dashboard"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:f="sap.f"
    xmlns:card="sap.f.cards"
    xmlns:core="sap.ui.core"
    xmlns:l="sap.ui.layout"
    xmlns:microchart="sap.suite.ui.microchart"
    xmlns:viz="sap.viz"
    displayBlock="true">
    
    <Page id="dashboardPage" title="Tourism Management Dashboard" showHeader="false" busy="{dashboard>/busy}" busyIndicatorDelay="0">
        <content>
            <f:DynamicPage id="dashboardDynamicPage" headerExpanded="true" fitContent="true">
                
                <!-- Dynamic Page Header -->
                <f:header>
                    <f:DynamicPageHeader id="dashboardHeader" pinnable="true">
                        <VBox id="headerContent">
                            <!-- Welcome Section -->
                            <HBox id="welcomeBox" justifyContent="SpaceBetween" alignItems="Center" class="sapUiLargeMarginBottom">
                                <VBox id="welcomeInfo">
                                    <Title id="welcomeTitle" text="Welcome back, {auth>/user/FullName}!" level="H2" class="sapUiNoMarginTop"/>
                                    <Text id="welcomeSubtitle" text="Here's what's happening with your tourism business today" class="sapUiMediumMarginTop"/>
                                    <HBox id="businessInfo" alignItems="Center" class="sapUiSmallMarginTop">
                                        <core:Icon id="companyIcon" src="sap-icon://building" class="sapUiTinyMarginEnd"/>
                                        <Text id="companyName" text="{dashboard>/workspaceInfo/CompanyName}" class="sapUiMediumText"/>
                                        <Text id="lastUpdate" text="Last updated: {dashboard>/lastUpdated}" class="sapUiTinyMarginBegin sapUiSmallText"/>
                                    </HBox>
                                </VBox>
                                
                                <!-- Quick Actions - Role-based visibility -->
                                <VBox id="quickActions" alignItems="End">
                                    <HBox id="actionButtons">
                                        <Button id="refreshBtn" 
                                            icon="sap-icon://refresh" 
                                            tooltip="Refresh Dashboard" 
                                            press=".onRefreshDashboard" 
                                            type="Transparent"/>
                                        <!-- Staff, Manager, Admin can create orders -->
                                        <Button id="createOrderBtn3" 
                                            text="New Order" 
                                            icon="sap-icon://add" 
                                            press=".onCreateOrder" 
                                            type="Emphasized" 
                                            class="sapUiTinyMarginBegin"/>
                                        <!-- Only Admin, Manager can create tours -->
                                        <Button id="createTourBtn" 
                                            text="New Tour" 
                                            icon="sap-icon://map-2" 
                                            press=".onCreateTour" 
                                            type="Ghost" 
                                            class="sapUiTinyMarginBegin"/>
                                    </HBox>
                                </VBox>
                            </HBox>
                        </VBox>
                    </f:DynamicPageHeader>
                </f:header>

                <!-- Dynamic Page Content -->
                <f:content>
                    <VBox id="dashboardContent" class="sapUiMediumMargin">
                        
                        <!-- Main KPI Cards Row -->
                        <HBox id="mainKpiRow" justifyContent="SpaceAround" class="sapUiLargeMarginBottom">
                            
                            <!-- Revenue Card - All roles can see -->
                            <f:Card id="revenueCard" class="sapUiTinyMargin dashboardCard" width="280px">
                                <f:header>
                                    <card:Header id="revenueHeader" 
                                        title="Revenue" 
                                        subtitle="This Month"
                                        iconSrc="sap-icon://money-bills" 
                                        iconDisplayShape="Circle"/>
                                </f:header>
                                <f:content>
                                    <VBox id="revenueContent" alignItems="Center" class="sapUiSmallMargin" width="100%" justifyContent="Center" height="140px">
                                        <ObjectNumber id="revenueAmount" 
                                            number="{dashboard>/kpis/totalRevenue}" 
                                            unit="USD" 
                                            state="Success" 
                                            emphasized="true" 
                                            class="sapMObjectNumberLarge"/>
                                        <!-- Hide growth details for Staff -->
                                        <HBox id="revenueGrowthDetails" alignItems="Center" class="sapUiSmallMarginTop">
                                            <core:Icon id="growthIcon" src="sap-icon://trend-up" color="Good" class="sapUiTinyMarginEnd"/>
                                            <Text id="growthText" text="+{dashboard>/kpis/revenueGrowth}% vs last month"/>
                                        </HBox>
                                    </VBox>
                                </f:content>
                            </f:Card>

                            <!-- Customer Card - Hide from Accountant -->
                            <f:Card id="customerCard" class="sapUiTinyMargin dashboardCard" width="280px">
                                <f:header>
                                    <card:Header id="customerHeader" 
                                        title="Customers" 
                                        subtitle="Total Active"
                                        iconSrc="sap-icon://group" 
                                        iconDisplayShape="Circle"/>
                                </f:header>
                                <f:content>
                                    <VBox id="customerContent" alignItems="Center" class="sapUiSmallMargin" width="100%" justifyContent="Center" height="140px">
                                        <ObjectNumber id="customerCount" 
                                            number="{dashboard>/kpis/totalCustomers}" 
                                            emphasized="true" 
                                            class="sapMObjectNumberLarge"/>
                                        <HBox id="customerBreakdown" justifyContent="SpaceAround" width="100%" class="sapUiSmallMarginTop">
                                            <VBox id="individualBox" alignItems="Center">
                                                <Text id="individualCount" text="{dashboard>/kpis/individualCustomers}"/>
                                                <Text id="individualLabel" text="Individual" class="sapUiSmallText"/>
                                            </VBox>
                                            <VBox id="businessBox" alignItems="Center">
                                                <Text id="businessCount" text="{dashboard>/kpis/businessCustomers}"/>
                                                <Text id="businessLabel" text="Business" class="sapUiSmallText"/>
                                            </VBox>
                                        </HBox>
                                    </VBox>
                                </f:content>
                            </f:Card>

                            <!-- Active Tours Card - Hide from Staff and Accountant -->
                            <f:Card id="toursCard" class="sapUiTinyMargin dashboardCard" width="280px">
                                <f:header>
                                    <card:Header id="toursHeader" 
                                        title="Active Tours" 
                                        subtitle="Currently Running"
                                        iconSrc="sap-icon://journey-arrive" 
                                        iconDisplayShape="Circle"/>
                                </f:header>
                                <f:content>
                                    <VBox id="toursContent" alignItems="Center" class="sapUiSmallMargin" width="100%" justifyContent="Center" height="140px">
                                        <ObjectNumber id="activeTourCount" 
                                            number="{dashboard>/kpis/activeTours}" 
                                            state="Information" 
                                            emphasized="true" 
                                            class="sapMObjectNumberLarge"/>
                                        <microchart:RadialMicroChart id="occupancyChart" 
                                            percentage="{dashboard>/kpis/averageOccupancy}" 
                                            size="S" 
                                            valueColor="{= ${dashboard>/kpis/averageOccupancy} > 80 ? 'Good' : ${dashboard>/kpis/averageOccupancy} > 60 ? 'Critical' : 'Error'}"
                                            class="sapUiSmallMarginTop" 
                                            alignContent="Center"/>
                                        <Text id="occupancyLabel" text="Avg. Occupancy" class="sapUiSmallText"/>
                                    </VBox>
                                </f:content>
                            </f:Card>

                            <!-- Profit Card - Hide from Staff -->
                            <f:Card id="profitCard" class="sapUiTinyMargin dashboardCard" width="280px">
                                <f:header>
                                    <card:Header id="profitHeader" 
                                        title="Profit Margin" 
                                        subtitle="Current Performance"
                                        iconSrc="sap-icon://chart" 
                                        iconDisplayShape="Circle"/>
                                </f:header>
                                <f:content>
                                    <VBox id="profitContent" alignItems="Center" class="sapUiSmallMargin" width="100%" justifyContent="Center" height="140px">
                                        <ObjectNumber id="profitMargin" 
                                            number="{dashboard>/kpis/profitMargin}" 
                                            unit="%" 
                                            state="{= ${dashboard>/kpis/profitMargin} > 20 ? 'Success' : ${dashboard>/kpis/profitMargin} > 10 ? 'Warning' : 'Error'}" 
                                            emphasized="true" 
                                            class="sapMObjectNumberLarge"/>
                                        <microchart:RadialMicroChart id="profitChart" 
                                            percentage="{dashboard>/kpis/profitMargin}" 
                                            size="S" 
                                            valueColor="{= ${dashboard>/kpis/profitMargin} > 20 ? 'Good' : ${dashboard>/kpis/profitMargin} > 10 ? 'Critical' : 'Error'}"
                                            class="sapUiSmallMarginTop" 
                                            alignContent="Center"/>
                                    </VBox>
                                </f:content>
                            </f:Card>
                        </HBox>

                        <!-- Secondary KPI Cards Row -->
                        <HBox id="secondaryKpiRow" justifyContent="SpaceAround" class="sapUiLargeMarginBottom">
                            
                            <!-- Tour Status Card - Only Admin, Manager -->
                            <f:Card id="tourStatusCard" class="sapUiTinyMargin dashboardCard" width="280px">
                                <f:header>
                                    <card:Header id="tourStatusHeader" 
                                        title="Tour Status" 
                                        subtitle="Current Distribution"
                                        iconSrc="sap-icon://status-completed" 
                                        iconDisplayShape="Circle"/>
                                </f:header>
                                <f:content>
                                    <VBox id="tourStatusContent" alignItems="Center" class="sapUiSmallMargin" width="100%" justifyContent="Center" height="140px">
                                        <HBox id="statusIndicators" justifyContent="SpaceAround" width="100%">
                                            <VBox id="openToursBox" alignItems="Center" class="sapUiTinyMargin">
                                                <ObjectNumber id="openToursCount" 
                                                    number="{dashboard>/kpis/tourStatusBreakdown/open}" 
                                                    state="Success" 
                                                    emphasized="true"/>
                                                <Text id="openToursLabel" text="Open" class="sapUiSmallText"/>
                                            </VBox>
                                            <VBox id="closedToursBox" alignItems="Center" class="sapUiTinyMargin">
                                                <ObjectNumber id="closedToursCount" 
                                                    number="{dashboard>/kpis/tourStatusBreakdown/closed}" 
                                                    state="Warning" 
                                                    emphasized="true"/>
                                                <Text id="closedToursLabel" text="Closed" class="sapUiSmallText"/>
                                            </VBox>
                                            <VBox id="completedToursBox" alignItems="Center" class="sapUiTinyMargin">
                                                <ObjectNumber id="completedToursCount" 
                                                    number="{dashboard>/kpis/tourStatusBreakdown/completed}" 
                                                    state="Information" 
                                                    emphasized="true"/>
                                                <Text id="completedToursLabel" text="Completed" class="sapUiSmallText"/>
                                            </VBox>
                                        </HBox>
                                        <Button id="statusDetailsBtn" 
                                            text="View Details" 
                                            type="Transparent" 
                                            press=".onShowTourStatusBreakdown"
                                            class="sapUiSmallMarginTop"/>
                                    </VBox>
                                </f:content>
                            </f:Card>

                            <!-- Orders Card - Hide from Accountant -->
                            <f:Card id="ordersCard" class="sapUiTinyMargin dashboardCard" width="280px">
                                <f:header>
                                    <card:Header id="ordersHeader" 
                                        title="Orders" 
                                        subtitle="Pending - Active"
                                        iconSrc="sap-icon://sales-order" 
                                        iconDisplayShape="Circle"/>
                                </f:header>
                                <f:content>
                                    <VBox id="ordersContent" alignItems="Center" class="sapUiSmallMargin" width="100%" justifyContent="Center" height="140px">
                                        <ObjectNumber id="pendingOrdersCount" 
                                            number="{dashboard>/kpis/pendingOrders}" 
                                            state="Warning" 
                                            emphasized="true" 
                                            class="sapMObjectNumberLarge"/>
                                        <ObjectNumber id="pendingOrdersValue" 
                                            number="{dashboard>/kpis/pendingOrdersValue}" 
                                            unit="USD" 
                                            state="None" 
                                            class="sapUiSmallMarginTop"/>
                                        <Button id="viewOrdersBtn" 
                                            text="View Orders" 
                                            type="Transparent" 
                                            press=".onViewOrders"
                                            class="sapUiSmallMarginTop"/>
                                    </VBox>
                                </f:content>
                            </f:Card>

                            <!-- Suppliers Card - Hide from Accountant -->
                            <f:Card id="suppliersCard" class="sapUiTinyMargin dashboardCard" width="280px">
                                <f:header>
                                    <card:Header id="suppliersHeader" 
                                        title="Suppliers" 
                                        subtitle="Active Partners"
                                        iconSrc="sap-icon://supplier" 
                                        iconDisplayShape="Circle"/>
                                </f:header>
                                <f:content>
                                    <VBox id="suppliersContent" alignItems="Center" class="sapUiSmallMargin" width="100%" justifyContent="Center" height="140px">
                                        <ObjectNumber id="totalSuppliersCount" 
                                            number="{dashboard>/kpis/totalSuppliers}" 
                                            emphasized="true" 
                                            class="sapMObjectNumberLarge"/>
                                        <Text id="suppliersLabel" text="Active Suppliers" class="sapUiSmallMarginTop"/>
                                        <Button id="viewSuppliersBtn" 
                                            text="View Suppliers" 
                                            type="Transparent" 
                                            press=".onViewSuppliers"
                                            class="sapUiSmallMarginTop"/>
                                    </VBox>
                                </f:content>
                            </f:Card>

                            <!-- Financial Overview Card - Only Admin, Accountant -->
                            <f:Card id="financialOverviewCard" class="sapUiTinyMargin dashboardCard" width="280px">
                                <f:header>
                                    <card:Header id="financialHeader" 
                                        title="Financial Overview" 
                                        subtitle="Payments - Debts"
                                        iconSrc="sap-icon://payment-approval" 
                                        iconDisplayShape="Circle"/>
                                </f:header>
                                <f:content>
                                    <VBox id="financialContent" alignItems="Center" class="sapUiSmallMargin" width="100%" justifyContent="Center" height="140px">
                                        <ObjectNumber id="pendingPaymentsAmount" 
                                            number="{dashboard>/kpis/pendingPayments}" 
                                            unit="USD" 
                                            emphasized="true" 
                                            class="sapMObjectNumberLarge"/>
                                        <Text id="pendingPaymentsLabel" text="Pending Payments" class="sapUiSmallMarginTop"/>
                                        <Button id="viewPaymentsBtn" 
                                            text="View Payments" 
                                            type="Transparent" 
                                            press=".onViewPayments"
                                            class="sapUiSmallMarginTop"/>
                                    </VBox>
                                </f:content>
                            </f:Card>
                        </HBox>

                        <!-- Management Cards Row - Admin Only -->
                        <HBox id="managementCardsRow" justifyContent="SpaceAround" class="sapUiLargeMarginBottom">
                            
                            <!-- Tours Needing Attention - Only Admin, Manager -->
                            <f:Card id="attentionCard" class="sapUiTinyMargin dashboardCard" width="430px">
                                <f:header>
                                    <card:Header id="attentionHeader" 
                                        title="Needs Attention" 
                                        subtitle="Tours Requiring Action"
                                        iconSrc="sap-icon://alert" 
                                        iconDisplayShape="Circle"/>
                                </f:header>
                                <f:content>
                                    <VBox id="attentionContent" alignItems="Center" class="sapUiSmallMargin" width="100%" justifyContent="Center" height="140px">
                                        <VBox id="attentionDetails" alignItems="Center">
                                            <HBox id="toCloseBox" alignItems="Center" class="sapUiSmallMarginBottom">
                                                <core:Icon id="closeIcon" src="sap-icon://locked" color="Critical" class="sapUiTinyMarginEnd"/>
                                                <Text id="toCloseText" text="{dashboard>/kpis/tourStatusBreakdown/needsAttention/toClose} to close"/>
                                            </HBox>
                                            <HBox id="toCompleteBox" alignItems="Center" class="sapUiSmallMarginBottom">
                                                <core:Icon id="completeIcon" src="sap-icon://accept" color="Good" class="sapUiTinyMarginEnd"/>
                                                <Text id="toCompleteText" text="{dashboard>/kpis/tourStatusBreakdown/needsAttention/toComplete} to complete"/>
                                            </HBox>
                                        </VBox>
                                        <Button id="autoUpdateBtn2" 
                                            text="Run Auto Updates" 
                                            type="Emphasized" 
                                            press=".onRunAutomatedUpdates"
                                            visible="{= (${dashboard>/kpis/tourStatusBreakdown/needsAttention/toClose} + ${dashboard>/kpis/tourStatusBreakdown/needsAttention/toComplete}) > 0 }"
                                            class="sapUiSmallMarginTop"/>
                                    </VBox>
                                </f:content>
                            </f:Card>

                            <!-- Workspace Settings Card - Admin Only -->
                            <f:Card id="workspaceCard" class="sapUiTinyMargin dashboardCard" width="430px">
                                <f:header>
                                    <card:Header id="workspaceHeader" 
                                        title="Workspace" 
                                        subtitle="System Settings"
                                        iconSrc="sap-icon://building" 
                                        iconDisplayShape="Circle"/>
                                </f:header>
                                <f:content>
                                    <VBox id="workspaceContent" alignItems="Center" class="sapUiSmallMargin" width="100%" justifyContent="Center" height="140px">
                                        <core:Icon id="workspaceIcon" src="sap-icon://business-objects-experience" size="2rem" color="Good"/>
                                        <Text id="workspaceCompanyName" text="{dashboard>/workspaceInfo/CompanyName}" class="sapUiMediumMarginTop"/>
                                        <Button id="viewSettingsBtn" 
                                            text="Manage Settings" 
                                            type="Transparent" 
                                            press=".onViewSettings"
                                            class="sapUiSmallMarginTop"/>
                                    </VBox>
                                </f:content>
                            </f:Card>
                        </HBox>

                        <!-- Upcoming Departures Panel - Hide from Accountant -->
                        <Panel id="upcomingDeparturesPanel" headerText="Upcoming Departures" class="sapUiResponsiveMargin" expanded="true">
                            <content>
                                <List id="upcomingDeparturesList" 
                                    items="{dashboard>/upcomingDepartures}" 
                                    noDataText="No upcoming departures"
                                    class="sapUiMediumMarginTop">
                                    <CustomListItem id="departureItem" press=".onDeparturePress">
                                        <HBox id="departureBox" justifyContent="SpaceBetween" alignItems="Center" class="sapUiMediumMargin">
                                            <VBox id="departureInfo">
                                                <Title id="departureTitle" text="{dashboard>tourName}" level="H4"/>
                                                <Text id="departureDate" text="Departure: {dashboard>departureDate}"/>
                                                <Text id="departureStatus" text="Status: {dashboard>status}"/>
                                            </VBox>
                                            <VBox id="departureStats" alignItems="End">
                                                <ObjectNumber id="departurePassengers" 
                                                    number="{dashboard>passengers}" 
                                                    unit="passengers"/>
                                                <ObjectStatus id="departureCapacity" 
                                                    text="{dashboard>capacity}% capacity" 
                                                    state="{= ${dashboard>capacity} > 80 ? 'Success' : ${dashboard>capacity} > 60 ? 'Warning' : 'Error'}"/>
                                            </VBox>
                                        </HBox>
                                    </CustomListItem>
                                </List>
                            </content>
                        </Panel>

                        <!-- Status Summary Bar - Only Admin, Manager -->
                        <Panel id="statusSummaryPanel" class="sapUiResponsiveMargin">
                            <content>
                                <HBox id="statusSummaryBar" justifyContent="SpaceBetween" alignItems="Center" class="sapUiMediumMargin">
                                    <HBox id="statusCounts" alignItems="Center">
                                        <Text id="statusSummaryLabel" text="Tour Status Summary:" class="sapUiMediumMarginEnd"/>
                                        <ObjectStatus id="openCount" 
                                            text="{dashboard>/kpis/tourStatusBreakdown/open} Open" 
                                            state="Success" 
                                            class="sapUiTinyMarginEnd"/>
                                        <ObjectStatus id="closedCount" 
                                            text="{dashboard>/kpis/tourStatusBreakdown/closed} Closed" 
                                            state="Warning" 
                                            class="sapUiTinyMarginEnd"/>
                                        <ObjectStatus id="completedCount" 
                                            text="{dashboard>/kpis/tourStatusBreakdown/completed} Completed" 
                                            state="Information" 
                                            class="sapUiTinyMarginEnd"/>
                                        <ObjectStatus id="canceledCount" 
                                            text="{dashboard>/kpis/tourStatusBreakdown/canceled} Canceled" 
                                            state="Error"/>
                                    </HBox>
                                    <Button id="refreshStatusBtn" 
                                        icon="sap-icon://refresh" 
                                        tooltip="Refresh Status Data" 
                                        press=".onRefreshDashboard" 
                                        type="Transparent"/>
                                </HBox>
                            </content>
                        </Panel>

                    </VBox>
                </f:content>
            </f:DynamicPage>
        </content>
    </Page>
</mvc:View>