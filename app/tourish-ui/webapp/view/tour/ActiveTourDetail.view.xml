<mvc:View controllerName="tourishui.controller.tour.ActiveTourDetail" xmlns="sap.m" xmlns:mvc="sap.ui.core.mvc" xmlns:core="sap.ui.core" xmlns:l="sap.ui.layout" xmlns:f="sap.ui.layout.form" xmlns:fo="sap.f" xmlns:card="sap.f.cards" xmlns:microchart="sap.suite.ui.microchart" displayBlock="true">
    <Page id="activeTourDetailPage" title="{activeTourDetail>/tour/TourName}" showNavButton="true" navButtonPress=".onNavBack" busy="{activeTourDetail>/busy}" busyIndicatorDelay="0">
        <headerContent>
            <ObjectStatus id="_IDGenObjectStatus18" text="{activeTourDetail>/tour/Status}" state="{= ${activeTourDetail>/tour/Status} === 'Open' ? 'Success' : ${activeTourDetail>/tour/Status} === 'Ongoing' ? 'Warning' : ${activeTourDetail>/tour/Status} === 'Completed' ? 'Information' : 'Error'}"/>
            <Text id="_IDGenText226" text="Capacity: {activeTourDetail>/tour/CurrentBookings}/{activeTourDetail>/tour/MaxCapacity}"/>
            <Text id="_IDGenText227" text="Occupancy: {
                                        path: 'activeTourDetail>/statistics/occupancyRate',
                                        formatter: '.formatPercentage'
                                    }"/>
        </headerContent>

        <content>
            <IconTabBar id="tourDetailTabBar" expanded="true" select=".onTabSelect" class="sapUiResponsiveContentPadding">
                <items>
                    <!-- Tab 1: General Information -->
                    <IconTabFilter id="_IDGenIconTabFilter2" text="General Information" key="general" icon="sap-icon://hint">
                        <VBox id="_IDGenVBox64">
                            <f:SimpleForm id="_IDGenSimpleForm13" editable="false" layout="ResponsiveGridLayout" labelSpanXL="3" labelSpanL="3" labelSpanM="3">
                                <f:content>
                                    <core:Title id="_IDGenTitle8" text="Tour Information"/>

                                    <Label id="_IDGenLabel177" text="Tour Name"/>
                                    <Text id="_IDGenText228" text="{activeTourDetail>/tour/TourName}"/>

                                    <Label id="_IDGenLabel178" text="Template"/>
                                    <Text id="_IDGenText229" text="{activeTourDetail>/template/TemplateName}"/>

                                    <Label id="_IDGenLabel179" text="Tour Type"/>
                                    <Text id="_IDGenText230" text="{activeTourDetail>/template/TourType}"/>

                                    <Label id="_IDGenLabel180" text="Departure Date"/>
                                    <Text id="_IDGenText231" text="{
                                                                                                                        path: 'activeTourDetail>/tour/DepartureDate',
                                                                                                                        formatter: '.formatDate'
                                                                                                                    }"/>

                                    <Label id="_IDGenLabel181" text="Return Date"/>
                                    <Text id="_IDGenText232" text="{
                                                                                                                        path: 'activeTourDetail>/tour/ReturnDate',
                                                                                                                        formatter: '.formatDate'
                                                                                                                    }"/>

                                    <Label id="_IDGenLabel182" text="Duration"/>
                                    <Text id="_IDGenText233" text="{activeTourDetail>/template/NumberDays} days / {activeTourDetail>/template/NumberNights} nights"/>

                                    <Label id="_IDGenLabel183" text="Sale Period"/>
                                    <Text id="_IDGenText234" text="{
                                                                                                                        path: 'activeTourDetail>/tour/SaleStartDate',
                                                                                                                        formatter: '.formatDate'
                                                                                                                    } - {
                                                                                                                        path: 'activeTourDetail>/tour/SaleEndDate',
                                                                                                                        formatter: '.formatDate'
                                                                                                                    }"/>

                                    <Label id="_IDGenLabel184" text="Responsible Person"/>
                                    <Text id="_IDGenText235" text="{activeTourDetail>/tour/ResponsiblePersonName}"/>

                                    <core:Title id="_IDGenTitle10" text="Description"/>

                                    <Label id="_IDGenLabel185" text=""/>
                                    <Text id="_IDGenText236" text="{activeTourDetail>/template/Description}"/>
                                </f:content>
                            </f:SimpleForm>

                            <!-- Images Section -->
                            <Title id="_IDGenTitle12" text="Tour Images" class="sapUiMediumMarginTop"/>
                            <Carousel id="tourImagesCarousel" pages="{activeTourDetail>/images}" height="400px">
                                <pages>
                                    <VBox id="_IDGenVBox65" alignItems="Center" justifyContent="Center">
                                        <Image id="_IDGenImage4" src="{activeTourDetail>ImageURL}" height="350px" densityAware="false"/>
                                        <Text id="_IDGenText237" text="{activeTourDetail>Caption}" class="sapUiSmallMarginTop"/>
                                    </VBox>
                                </pages>
                            </Carousel>
                        </VBox>
                    </IconTabFilter>

                    <!-- Tab 2: Schedule -->
                    <IconTabFilter id="_IDGenIconTabFilter3" text="Schedule" key="schedule" icon="sap-icon://calendar">
                        <VBox id="_IDGenVBox66">
                            <List id="_IDGenList1" items="{activeTourDetail>/schedules}">
                                <items>
                                    <CustomListItem id="_IDGenCustomListItem">
                                        <Panel id="_IDGenPanel10" expandable="true" expanded="{= ${activeTourDetail>DayNumber} === 1}" headerText="Day {activeTourDetail>DayNumber}: {activeTourDetail>DayTitle}">
                                            <VBox id="_IDGenVBox67" class="sapUiSmallMargin">
                                                <Text id="_IDGenText238" text="{activeTourDetail>Overview}" class="sapUiSmallMarginBottom"/>

                                                <HBox id="_IDGenHBox41" class="sapUiSmallMarginBottom">
                                                    <CheckBox id="_IDGenCheckBox1" text="Breakfast" selected="{activeTourDetail>BreakfastIncluded}" enabled="false"/>
                                                    <CheckBox id="_IDGenCheckBox2" text="Lunch" selected="{activeTourDetail>LunchIncluded}" enabled="false" class="sapUiSmallMarginBegin"/>
                                                    <CheckBox id="_IDGenCheckBox3" text="Dinner" selected="{activeTourDetail>DinnerIncluded}" enabled="false" class="sapUiSmallMarginBegin"/>
                                                </HBox>

                                                <Title id="_IDGenTitle16" text="Activities" level="H4"/>
                                                <List id="_IDGenList2" items="{activeTourDetail>Activities}">
                                                    <items>
                                                        <StandardListItem id="_IDGenStandardListItem" title="{activeTourDetail>Title}" description="{activeTourDetail>Description}" info="{activeTourDetail>StartTime} - {activeTourDetail>EndTime}"/>
                                                    </items>
                                                </List>
                                            </VBox>
                                        </Panel>
                                    </CustomListItem>
                                </items>
                            </List>
                        </VBox>
                    </IconTabFilter>

                    <!-- Tab 3: Price & Terms -->
                    <IconTabFilter id="_IDGenIconTabFilter4" text="Price - Terms" key="priceTerms" icon="sap-icon://money-bills">
                        <VBox id="_IDGenVBox68">
                            <f:SimpleForm id="_IDGenSimpleForm14" editable="false" layout="ResponsiveGridLayout" labelSpanXL="3" labelSpanL="3" labelSpanM="3">
                                <f:content>
                                    <core:Title id="_IDGenTitle24" text="Pricing"/>

                                    <Label id="_IDGenLabel186" text="Adult Price:"/>
                                    <ObjectNumber id="_IDGenObjectNumber31" number="{
                                                                                                                        path: 'activeTourDetail>/priceTerms/AdultPrice',
                                                                                                                        formatter: '.formatCurrency'
                                                                                                                    }" unit="USD"/>

                                    <Label id="_IDGenLabel187" text="Children Price:"/>
                                    <ObjectNumber id="_IDGenObjectNumber32" number="{
                                                                                                                        path: 'activeTourDetail>/priceTerms/ChildrenPrice',
                                                                                                                        formatter: '.formatCurrency'
                                                                                                                    }" unit="USD"/>

                                    <core:Title id="_IDGenTitle25" text="Services Included"/>
                                    <Label id="_IDGenLabel188" text=""/>
                                    <Text id="_IDGenText239" text="{activeTourDetail>/priceTerms/ServicesIncluded}"/>

                                    <core:Title id="_IDGenTitle26" text="Services Not Included"/>
                                    <Label id="_IDGenLabel189" text=""/>
                                    <Text id="_IDGenText240" text="{activeTourDetail>/priceTerms/ServicesNotIncluded}"/>

                                    <core:Title id="_IDGenTitle27" text="Cancellation Terms"/>
                                    <Label id="_IDGenLabel190" text=""/>
                                    <Text id="_IDGenText241" text="{activeTourDetail>/priceTerms/CancellationTerms}"/>

                                    <core:Title id="_IDGenTitle28" text="General Terms"/>
                                    <Label id="_IDGenLabel191" text=""/>
                                    <Text id="_IDGenText242" text="{activeTourDetail>/priceTerms/GeneralTerms}"/>
                                </f:content>
                            </f:SimpleForm>
                        </VBox>
                    </IconTabFilter>

                    <!-- Tab 4: Services -->
                    <IconTabFilter id="_IDGenIconTabFilter5" text="Services" key="services" icon="sap-icon://activity-items">
                        <VBox id="_IDGenVBox69">
                            <OverflowToolbar id="_IDGenOverflowToolbar14">
                                <Title id="_IDGenTitle29" text="Tour Services"/>
                                <ToolbarSpacer id="_IDGenToolbarSpacer40"/>
                                <Button id="_IDGenButton33" text="Add Service" icon="sap-icon://add" press=".onAddService" type="Emphasized"/>
                            </OverflowToolbar>

                            <Table id="_IDGenTable2" items="{activeTourDetail>/services}" mode="None" alternateRowColors="true">
                                <columns>
                                    <Column id="_IDGenColumn96">
                                        <Text id="_IDGenText243" text="Service Name"/>
                                    </Column>
                                    <Column id="_IDGenColumn99">
                                        <Text id="_IDGenText244" text="Service Type"/>
                                    </Column>
                                    <Column id="_IDGenColumn100">
                                        <Text id="_IDGenText245" text="Supplier"/>
                                    </Column>
                                    <Column id="_IDGenColumn101" hAlign="End">
                                        <Text id="_IDGenText246" text="Quantity"/>
                                    </Column>
                                    <Column id="_IDGenColumn102" hAlign="End">
                                        <Text id="_IDGenText247" text="Unit Price"/>
                                    </Column>
                                    <Column id="_IDGenColumn103" hAlign="End">
                                        <Text id="_IDGenText248" text="Total Price"/>
                                    </Column>
                                    <Column id="_IDGenColumn104">
                                        <Text id="_IDGenText249" text="Notes"/>
                                    </Column>
                                    <Column id="_IDGenColumn105" hAlign="Center">
                                        <Text id="_IDGenText250" text="Actions"/>
                                    </Column>
                                </columns>
                                <items>
                                    <ColumnListItem id="_IDGenColumnListItem17">
                                        <cells>
                                            <Text id="_IDGenText251" text="{activeTourDetail>ServiceName}"/>
                                            <Text id="_IDGenText252" text="{activeTourDetail>ServiceType}"/>
                                            <Text id="_IDGenText253" text="{activeTourDetail>SupplierName}"/>
                                            <ObjectNumber id="_IDGenObjectNumber34" number="{activeTourDetail>Quantity}"/>
                                            <ObjectNumber id="_IDGenObjectNumber35" number="{
                                                                                                                                                path: 'activeTourDetail>UnitPrice',
                                                                                                                                                formatter: '.formatCurrency'
                                                                                                                                            }" unit="USD"/>
                                            <ObjectNumber id="_IDGenObjectNumber36" number="{
                                                                                                                                                path: 'activeTourDetail>TotalPrice',
                                                                                                                                                formatter: '.formatCurrency'
                                                                                                                                            }" unit="USD" emphasized="true"/>
                                            <Text id="_IDGenText254" text="{activeTourDetail>Notes}"/>
                                            <HBox id="_IDGenHBox45" justifyContent="End">
                                                <Button id="_IDGenButton80" icon="sap-icon://edit" press=".onEditService" type="Transparent"/>
                                                <Button id="_IDGenButton43" icon="sap-icon://delete" press=".onDeleteService" type="Transparent"/>
                                            </HBox>
                                        </cells>
                                    </ColumnListItem>
                                </items>
                            </Table>
                        </VBox>
                    </IconTabFilter>

                    <!-- Tab 5: Passengers -->
                    <IconTabFilter id="_IDGenIconTabFilter8" text="Passengers" key="passengers" icon="sap-icon://group">
                        <VBox id="_IDGenVBox70">
                            <OverflowToolbar id="_IDGenOverflowToolbar15">
                                <Title id="_IDGenTitle30" text="Tour Passengers"/>
                                <ToolbarSpacer id="_IDGenToolbarSpacer41"/>
                                <Text id="_IDGenText255" text="Total Orders: {activeTourDetail>/statistics/totalOrders}"/>
                                <Text id="_IDGenText256" text="Total Passengers Already Fill Data: {activeTourDetail>/statistics/totalPassengers}" class="sapUiSmallMarginBegin"/>
                            </OverflowToolbar>

                            <!-- Orders with Passengers -->
                            <VBox id="_IDGenVBox81" items="{activeTourDetail>/ordersWithPassengers}">
                                <Panel id="_IDGenPanel12" expandable="true" expanded="true" class="sapUiSmallMarginTop">
                                <headerToolbar>
                                        <Toolbar id="_IDGenToolbar17">
                                            <Title id="_IDGenTitle33" text="Order {= ${activeTourDetail>OrderID}.substring(0, 8)} - {activeTourDetail>CustomerName} ({activeTourDetail>AdultCount} Adults, {activeTourDetail>ChildCount} Children)" level="H4"/>
                                            <ToolbarSpacer id="_IDGenToolbarSpacer44"/>
                                            <Button id="_IDGenButton59" text="Generate Invoice" icon="sap-icon://pdf-attachment" tooltip="Generate Invoice for this Order" press=".onGenerateInvoice" type="Emphasized"/>
                                        </Toolbar>
                                    </headerToolbar>
                                    <VBox id="_IDGenVBox82">
                                        <HBox id="_IDGenHBox43" class="sapUiSmallMarginBottom">
                                            <Label id="_IDGenLabel216" text="Order Date: " design="Bold"/>
                                            <Text id="_IDGenText257" text="{
                                                                                                                            path: 'activeTourDetail>OrderDate',
                                                                                                                            formatter: '.formatDate'
                                                                                                                        }"/>
                                            <Label id="_IDGenLabel217" text="Paid: " design="Bold" class="sapUiSmallMarginBegin"/>
                                            <ObjectStatus id="_IDGenObjectStatus19" text="{activeTourDetail>Status}" state="{= ${activeTourDetail>Status} === 'Completed' ? 'Success' : 'Warning'}"/>
                                        </HBox>

                                        <Table id="_IDGenTable3" items="{activeTourDetail>Passengers}" alternateRowColors="true">
                                            <columns>
                                                <Column id="_IDGenColumn106" width="80px">
                                                    <Text id="_IDGenText258" text="Type"/>
                                                </Column>
                                                <Column id="_IDGenColumn107">
                                                    <Text id="_IDGenText259" text="Full Name"/>
                                                </Column>
                                                <Column id="_IDGenColumn108" width="100px">
                                                    <Text id="_IDGenText260" text="Gender"/>
                                                </Column>
                                                <Column id="_IDGenColumn109">
                                                    <Text id="_IDGenText261" text="Birth Date"/>
                                                </Column>
                                                <Column id="_IDGenColumn110">
                                                    <Text id="_IDGenText262" text="ID Number"/>
                                                </Column>
                                                <Column id="_IDGenColumn111">
                                                    <Text id="_IDGenText263" text="Phone"/>
                                                </Column>
                                                <Column id="_IDGenColumn112">
                                                    <Text id="_IDGenText264" text="Email"/>
                                                </Column>
                                                <Column id="_IDGenColumn113">
                                                    <Text id="_IDGenText265" text="Special Requirements"/>
                                                </Column>
                                                <Column id="_IDGenColumn114" width="120px" hAlign="Center">
                                                    <Text id="_IDGenText266" text="Actions"/>
                                                </Column>
                                            </columns>
                                            <items>
                                                <ColumnListItem id="_IDGenColumnListItem18">
                                                    <cells>
                                                        <ObjectStatus id="_IDGenObjectStatus20" text="{= ${activeTourDetail>IsAdult} ? 'Adult' : 'Child'}" state="{= ${activeTourDetail>IsAdult} ? 'Success' : 'Warning'}"/>
                                                        <Text id="_IDGenText267" text="{= ${activeTourDetail>IsPlaceholder} ? '(Not filled)' : ${activeTourDetail>FullName}}" class="{= ${activeTourDetail>IsPlaceholder} ? 'sapUiTextItalic' : ''}"/>
                                                        <Text id="_IDGenText268" text="{activeTourDetail>Gender}"/>
                                                        <Text id="_IDGenText269" text="{
                                                                                                                                                                path: 'activeTourDetail>BirthDate',
                                                                                                                                                                formatter: '.formatDate'
                                                                                                                                                            }"/>
                                                        <Text id="_IDGenText270" text="{activeTourDetail>IDNumber}"/>
                                                        <Text id="_IDGenText271" text="{activeTourDetail>Phone}"/>
                                                        <Text id="_IDGenText272" text="{activeTourDetail>Email}"/>
                                                        <Text id="_IDGenText273" text="{activeTourDetail>SpecialRequirements}"/>
                                                        <HBox id="_IDGenHBox44" justifyContent="End">
                                                            <Button id="_IDGenButton55" icon="{= ${activeTourDetail>IsPlaceholder} ? 'sap-icon://add' : 'sap-icon://edit'}" press=".onEditPassenger" tooltip="{= ${activeTourDetail>IsPlaceholder} ? 'Add Passenger' : 'Edit Passenger'}" type="Transparent"/>
                                                            <Button id="_IDGenButton73" icon="sap-icon://delete" press=".onDeletePassenger" tooltip="Delete Passenger" type="Transparent" visible="{= !${activeTourDetail>IsPlaceholder}}"/>
                                                        </HBox>
                                                    </cells>
                                                </ColumnListItem>
                                            </items>
                                        </Table>
                                    </VBox>
                                </Panel>
                            </VBox>
                        </VBox>
                    </IconTabFilter>

                    <!-- Tab 6: Tour Estimate -->
                    <IconTabFilter id="_IDGenIconTabFilter7" text="Tour Estimate" key="estimate" icon="sap-icon://sales-quote">
                        <ScrollContainer id="_IDGenScrollContainer1" height="100%" width="100%" vertical="true">
                            <VBox
                                id="_IDGenVBox71" class="sapUiResponsiveMargin">
                                <!-- Header Toolbar -->
                                <OverflowToolbar id="_IDGenOverflowToolbar16" class="sapUiMediumMarginBottom">
                                    <Title id="_IDGenTitle31" text="Financial Analysis"/>
                                    <ToolbarSpacer id="_IDGenToolbarSpacer42"/>
                                    <Button id="_IDGenButton84" text="Refresh Calculations" icon="sap-icon://refresh" press=".onRefreshEstimate" type="Ghost"/>
                                    <ToolbarSeparator id="_IDGenToolbarSeparator3"/>
                                    <Button id="_IDGenButton85" text="Add Cost Item" icon="sap-icon://add" press=".onAddCostItem" type="Emphasized"/>
                                    <Button id="_IDGenButton86" text="Generate Report" icon="sap-icon://pdf-attachment" press=".onGenerateEstimateReport"/>
                                </OverflowToolbar>

                                <!-- Key Metrics Cards -->
                                <l:Grid
                                    id="_IDGenGrid6" defaultSpan="L3 M6 S12" containerQuery="true">
                                    <!-- Revenue Card -->
                                    <fo:Card id="_IDGenCard1" class="sapUiTinyMargin">
                                        <fo:header>
                                            <card:Header id="_IDGenHeader1" title="Total Revenue" iconSrc="sap-icon://sales-order" iconDisplayShape="Square" statusText="Auto-calculated"/>
                                        </fo:header>
                                        <fo:content>
                                            <VBox id="_IDGenVBox72" alignItems="Center" justifyContent="Center" height="120px">
                                                <ObjectNumber id="_IDGenObjectNumber45" number="{path: 'activeTourDetail>/statistics/totalRevenue', formatter: '.formatCurrency'}" unit="{activeTourDetail>/currency}" state="Success" emphasized="true" class="sapMObjectNumberLarge sapUiSmallMarginBegin" />
                                                <Text id="_IDGenText275" text="{activeTourDetail>/statistics/totalOrders} orders" class="sapUiSmallMarginTop"/>
                                            </VBox>
                                        </fo:content>
                                    </fo:Card>

                                    <!-- Cost Card -->
                                    <fo:Card id="_IDGenCard2" class="sapUiTinyMargin">
                                        <fo:header>
                                            <card:Header id="_IDGenHeader2" title="Total Cost" iconSrc="sap-icon://expense-report" iconDisplayShape="Square" statusText="{= ${activeTourDetail>/statistics/costItemsCount} + ' items'}"/>
                                        </fo:header>
                                        <fo:content>
                                            <VBox id="_IDGenVBox73" alignItems="Center" justifyContent="Center" height="120px">
                                                <ObjectNumber id="_IDGenObjectNumber46" number="{
                                                                                                        path: 'activeTourDetail>/statistics/totalCost',
                                                                                                        formatter: '.formatCurrency'
                                                                                                    }" unit="{activeTourDetail>/currency}" state="Error" emphasized="true" class="sapMObjectNumberLarge sapUiSmallMarginBegin"/>
                                                <ProgressIndicator id="_IDGenProgressIndicator" percentValue="{= Math.round((${activeTourDetail>/statistics/totalCost} / ${activeTourDetail>/statistics/totalRevenue}) * 100 * 10) / 10}" 
                                                displayValue="{= Math.round((${activeTourDetail>/statistics/totalCost} / ${activeTourDetail>/statistics/totalRevenue}) * 100 * 10) / 10 + '%'}"  width="200%"/>
                                            </VBox>
                                        </fo:content>
                                    </fo:Card>

                                    <!-- Profit Card -->
                                    <fo:Card id="_IDGenCard3" class="sapUiTinyMargin">
                                        <fo:header>
                                            <card:Header id="_IDGenHeader3" title="Net Profit" iconSrc="sap-icon://money-bills" iconDisplayShape="Square" statusText="{= ${activeTourDetail>/statistics/profitMargin} + '% margin'}"/>
                                        </fo:header>
                                        <fo:content>
                                            <VBox id="_IDGenVBox74" alignItems="Center" justifyContent="Center" height="120px">
                                                <ObjectNumber id="_IDGenObjectNumber47" number="{
                                                                                                        path: 'activeTourDetail>/statistics/netProfit',
                                                                                                        formatter: '.formatCurrency'
                                                                                                    }" unit="{activeTourDetail>/currency}" state="{= ${activeTourDetail>/statistics/netProfit} >= 0 ? 'Success' : 'Error'}" emphasized="true" class="sapMObjectNumberLarge sapUiSmallMarginBegin"/>
                                                <HBox id="_IDGenHBox46" class="sapUiSmallMarginTop">
                                                    <core:Icon id="_IDGenIcon3" src="{= ${activeTourDetail>/statistics/netProfit} >= 0 ? 'sap-icon://trend-up' : 'sap-icon://trend-down'}" color="{= ${activeTourDetail>/statistics/netProfit} >= 0 ? 'Positive' : 'Negative'}"/>
                                                    <Text id="_IDGenText276" text="{= ${activeTourDetail>/statistics/profitMargin} + '%'}" class="sapUiTinyMarginBegin"/>
                                                </HBox>
                                            </VBox>
                                        </fo:content>
                                    </fo:Card>

                                    <!-- Occupancy Card -->
                                    <fo:Card id="_IDGenCard4" class="sapUiTinyMargin">
                                        <fo:header>
                                            <card:Header id="_IDGenHeader4" title="Occupancy" iconSrc="sap-icon://group" iconDisplayShape="Square" statusText="{= ${activeTourDetail>/tour/CurrentBookings} + '/' + ${activeTourDetail>/tour/MaxCapacity}}"/>
                                        </fo:header>
                                        <fo:content>
                                            <VBox id="_IDGenVBox75" alignItems="Center" justifyContent="Center" height="120px">
                                                <microchart:RadialMicroChart id="_IDGenRadialMicroChart1" percentage="{activeTourDetail>/statistics/occupancyRate}" press=".onOccupancyPress" size="S" valueColor="{= ${activeTourDetail>/statistics/occupancyRate} > 80 ? 'Good' : ${activeTourDetail>/statistics/occupancyRate} > 50 ? 'Critical' : 'Error'}" class="sapUiSmallMarginBegin"/>
                                            </VBox>
                                        </fo:content>
                                    </fo:Card>
                                </l:Grid>

                                <!-- Revenue Breakdown Panel -->
                                <Panel id="_IDGenPanel13" headerText="Revenue Breakdown" expandable="true" expanded="true" class="sapUiMediumMarginTop">
                                    <Table id="_IDGenTable5" alternateRowColors="true">
                                        <columns>
                                            <Column id="_IDGenColumn120">
                                                <Text id="_IDGenText278" text="Category"/>
                                            </Column>
                                            <Column id="_IDGenColumn121" hAlign="Center">
                                                <Text id="_IDGenText279" text="Quantity"/>
                                            </Column>
                                            <Column id="_IDGenColumn122" hAlign="End">
                                                <Text id="_IDGenText280" text="Unit Price"/>
                                            </Column>
                                            <Column id="_IDGenColumn123" hAlign="End">
                                                <Text id="_IDGenText281" text="Total"/>
                                            </Column>
                                        </columns>
                                        <items>
                                            <ColumnListItem id="_IDGenColumnListItem20">
                                                <cells>
                                                    <Text id="_IDGenText282" text="Adult Tickets"/>
                                                    <Text id="_IDGenText283" text="{activeTourDetail>/statistics/totalAdults}"/>
                                                    <ObjectNumber id="_IDGenObjectNumber48" number="{
                                                                                                                path: 'activeTourDetail>/priceTerms/AdultPrice',
                                                                                                                formatter: '.formatCurrency'
                                                                                                            }" unit="{activeTourDetail>/currency}"/>
                                                    <ObjectNumber id="_IDGenObjectNumber49" number="{
                                                                                                                path: 'activeTourDetail>/statistics/adultRevenue',
                                                                                                                formatter: '.formatCurrency'
                                                                                                            }" unit="{activeTourDetail>/currency}" state="Success"/>
                                                </cells>
                                            </ColumnListItem>
                                            <ColumnListItem id="_IDGenColumnListItem21">
                                                <cells>
                                                    <Text id="_IDGenText322" text="Children Tickets"/>
                                                    <Text id="_IDGenText323" text="{activeTourDetail>/statistics/totalChildren}"/>
                                                    <ObjectNumber id="_IDGenObjectNumber50" number="{
                                                                                                                path: 'activeTourDetail>/priceTerms/ChildrenPrice',
                                                                                                                formatter: '.formatCurrency'
                                                                                                            }" unit="{activeTourDetail>/currency}"/>
                                                    <ObjectNumber id="_IDGenObjectNumber51" number="{
                                                                                                                path: 'activeTourDetail>/statistics/childRevenue',
                                                                                                                formatter: '.formatCurrency'
                                                                                                            }" unit="{activeTourDetail>/currency}" state="Success"/>
                                                </cells>
                                            </ColumnListItem>
                                            <ColumnListItem id="_IDGenColumnListItem22">
                                                <cells>
                                                    <Text id="_IDGenText295" text="Discounts Applied"/>
                                                    <Text id="_IDGenText296" text="-"/>
                                                    <Text id="_IDGenText297" text="-"/>
                                                    <ObjectNumber id="_IDGenObjectNumber52" number="{
                                                                                                                path: 'activeTourDetail>/statistics/totalDiscounts',
                                                                                                                formatter: '.formatCurrency'
                                                                                                            }" unit="{activeTourDetail>/currency}" state="Error"/>
                                                </cells>
                                            </ColumnListItem>
                                            <ColumnListItem id="_IDGenColumnListItem19">
                                                <cells>
                                                    <Text id="_IDGenText324" text="Total "/>
                                                    <Text id="_IDGenText325" text="-"/>
                                                    <Text id="_IDGenText326" text="-"/>
                                                    <ObjectNumber id="_IDGenObjectNumber30" number="{
                                                                                                                path: 'activeTourDetail>/statistics/totalRevenue',
                                                                                                                formatter: '.formatCurrency'
                                                                                                            }" unit="{activeTourDetail>/currency}" state="Success"/>
                                                </cells>
                                            </ColumnListItem>
                                        </items>
                                    </Table>
                                </Panel>

                                <!-- Cost Breakdown Panel -->
                                <Panel id="_IDGenPanel14" headerText="Cost Analysis" expandable="true" expanded="true" class="sapUiMediumMarginTop">
                                    <VBox
                                        id="_IDGenVBox88">
                                        <!-- Service Costs -->
                                        <Title id="_IDGenTitle32" text="Service Costs" level="H4" class="sapUiSmallMarginBottom"/>
                                        <Table id="_IDGenTable6" items="{activeTourDetail>/statistics/serviceCosts}" alternateRowColors="true" visible="{= ${activeTourDetail>/statistics/serviceCosts}.length > 0}">
                                            <columns>
                                                <Column id="_IDGenColumn124">
                                                    <Text id="_IDGenText298" text="Service"/>
                                                </Column>
                                                <Column id="_IDGenColumn125">
                                                    <Text id="_IDGenText299" text="Supplier"/>
                                                </Column>
                                                <Column id="_IDGenColumn126" hAlign="Center">
                                                    <Text id="_IDGenText300" text="Qty"/>
                                                </Column>
                                                <Column id="_IDGenColumn127" hAlign="End">
                                                    <Text id="_IDGenText301" text="Unit Cost"/>
                                                </Column>
                                                <Column id="_IDGenColumn128" hAlign="End">
                                                    <Text id="_IDGenText302" text="Total"/>
                                                </Column>
                                            </columns>
                                            <items>
                                                <ColumnListItem id="_IDGenColumnListItem23">
                                                    <cells>
                                                        <Text id="_IDGenText303" text="{activeTourDetail>ServiceName}"/>
                                                        <Text id="_IDGenText304" text="{activeTourDetail>SupplierName}"/>
                                                        <Text id="_IDGenText305" text="{activeTourDetail>Quantity}"/>
                                                        <ObjectNumber id="_IDGenObjectNumber53" number="{
                                                                                                                        path: 'activeTourDetail>UnitPrice',
                                                                                                                        formatter: '.formatCurrency'
                                                                                                                    }" unit="{activeTourDetail>/currency}"/>
                                                        <ObjectNumber id="_IDGenObjectNumber54" number="{
                                                                                                                        path: 'activeTourDetail>TotalPrice',
                                                                                                                        formatter: '.formatCurrency'
                                                                                                                    }" unit="{activeTourDetail>/currency}" state="Error"/>
                                                    </cells>
                                                </ColumnListItem>
                                            </items>
                                        </Table>

                                        <!-- Additional Cost Items -->
                                        <Title id="_IDGenTitle40" text="Additional Costs" level="H4" class="sapUiMediumMarginTop sapUiSmallMarginBottom"/>
                                        <Table id="_IDGenTable7" items="{activeTourDetail>/estimate/CostItems}" mode="SingleSelectMaster" alternateRowColors="true">
                                            <headerToolbar>
                                                <OverflowToolbar id="_IDGenOverflowToolbar17">
                                                    <ToolbarSpacer id="_IDGenToolbarSpacer43"/>
                                                    <Button id="_IDGenButton87" icon="sap-icon://add" press=".onAddCostItem" tooltip="Add Cost Item"/>
                                                </OverflowToolbar>
                                            </headerToolbar>
                                            <columns>
                                                <Column id="_IDGenColumn129">
                                                    <Text id="_IDGenText306" text="Item"/>
                                                </Column>
                                                <Column id="_IDGenColumn130">
                                                    <Text id="_IDGenText307" text="Category"/>
                                                </Column>
                                                <Column id="_IDGenColumn131" hAlign="End">
                                                    <Text id="_IDGenText308" text="Amount"/>
                                                </Column>
                                                <Column id="_IDGenColumn132">
                                                    <Text id="_IDGenText309" text="Notes"/>
                                                </Column>
                                                <Column id="_IDGenColumn133" width="100px">
                                                    <Text id="_IDGenText310" text="Actions"/>
                                                </Column>
                                            </columns>
                                            <items>
                                                <ColumnListItem id="_IDGenColumnListItem24">
                                                    <cells>
                                                        <Text id="_IDGenText311" text="{activeTourDetail>ItemName}"/>
                                                        <Text id="_IDGenText312" text="{activeTourDetail>Category}"/>
                                                        <ObjectNumber id="_IDGenObjectNumber55" number="{
                                                                                                                        path: 'activeTourDetail>Cost',
                                                                                                                        formatter: '.formatCurrency'
                                                                                                                    }" unit="{activeTourDetail>/currency}" state="Error"/>
                                                        <Text id="_IDGenText313" text="{activeTourDetail>Notes}"/>
                                                        <HBox id="_IDGenHBox47">
                                                            <Button id="_IDGenButton88" icon="sap-icon://edit" press=".onEditCostItem" type="Transparent"/>
                                                            <Button id="_IDGenButton89" icon="sap-icon://delete" press=".onDeleteCostItem" type="Transparent"/>
                                                        </HBox>
                                                    </cells>
                                                </ColumnListItem>
                                            </items>
                                        </Table>

                                        <!-- Cost Summary -->
                                        <HBox id="_IDGenHBox48" justifyContent="End" class="sapUiMediumMarginTop">
                                            <VBox id="_IDGenVBox83" alignItems="End">
                                                <HBox id="_IDGenHBox49" class="sapUiTinyMarginBottom">
                                                    <Text id="_IDGenText314" text="Service Costs:" class="sapUiSmallMarginEnd"/>
                                                    <ObjectNumber id="_IDGenObjectNumber56" number="{
                                                                                                                path: 'activeTourDetail>/statistics/totalServiceCost',
                                                                                                                formatter: '.formatCurrency'
                                                                                                            }" unit="{activeTourDetail>/currency}"/>
                                                </HBox>
                                                <HBox id="_IDGenHBox50" class="sapUiTinyMarginBottom">
                                                    <Text id="_IDGenText315" text="Additional Costs:" class="sapUiSmallMarginEnd"/>
                                                    <ObjectNumber id="_IDGenObjectNumber57" number="{
                                                                                                                path: 'activeTourDetail>/statistics/totalAdditionalCost',
                                                                                                                formatter: '.formatCurrency'
                                                                                                            }" unit="{activeTourDetail>/currency}"/>
                                                </HBox>
                                                <HBox id="_IDGenHBox51" class="sapUiSmallMarginTop">
                                                    <Text id="_IDGenText316" text="Total Cost:" class="sapUiSmallMarginEnd"/>
                                                    <ObjectNumber id="_IDGenObjectNumber58" number="{
                                                                                                                path: 'activeTourDetail>/statistics/totalCost',
                                                                                                                formatter: '.formatCurrency'
                                                                                                            }" unit="{activeTourDetail>/currency}" state="Error" emphasized="true"/>
                                                </HBox>
                                            </VBox>
                                        </HBox>
                                    </VBox>
                                </Panel>

                                <!-- Profit Analysis Panel -->
                                <Panel id="_IDGenPanel15" headerText="Profitability Analysis" expandable="true" expanded="true" class="sapUiMediumMarginTop">
                                    <VBox id="_IDGenVBox84">
                                        <HBox id="_IDGenHBox52" justifyContent="SpaceBetween" class="sapUiSmallMarginBottom">
                                            <VBox id="_IDGenVBox85">
                                                <Text id="_IDGenText317" text="Break-even Point"/>
                                                <Text id="_IDGenText318" text="{activeTourDetail>/statistics/breakEvenPassengers} passengers needed" class="sapUiTinyMarginTop"/>
                                            </VBox>
                                            <VBox id="_IDGenVBox86" alignItems="End">
                                                <Text id="_IDGenText319" text="Current Status"/>
                                                <ObjectStatus id="_IDGenObjectStatus21" text="{= ${activeTourDetail>/statistics/totalPassengers} >= ${activeTourDetail>/statistics/breakEvenPassengers} ? 'Profitable' : 'Below Break-even'}" state="{= ${activeTourDetail>/statistics/totalPassengers} >= ${activeTourDetail>/statistics/breakEvenPassengers} ? 'Success' : 'Error'}"/>
                                            </VBox>
                                        </HBox>

                                        <ProgressIndicator id="_IDGenProgressIndicator2" percentValue="{= ${activeTourDetail>/statistics/totalPassengers} / ${activeTourDetail>/statistics/breakEvenPassengers} * 100}" displayValue="{= ${activeTourDetail>/statistics/totalPassengers} + ' / ' + ${activeTourDetail>/statistics/breakEvenPassengers} + ' passengers'}" showValue="true" state="{= ${activeTourDetail>/statistics/totalPassengers} >= ${activeTourDetail>/statistics/breakEvenPassengers} ? 'Success' : 'Error'}"/>
                                    </VBox>
                                </Panel>

                                <!-- Notes Section -->
                                <Panel id="_IDGenPanel16" headerText="Estimate Notes" expandable="true" expanded="false" class="sapUiMediumMarginTop">
                                    <VBox id="_IDGenVBox87">
                                        <TextArea id="_IDGenTextArea5" value="{activeTourDetail>/estimate/Notes}" rows="4" width="100%" editable="false"/>
                                        <HBox id="_IDGenHBox53" justifyContent="End" class="sapUiSmallMarginTop">
                                            <Text id="_IDGenText320" text="Last updated: "/>
                                            <Text id="_IDGenText321" text="{
                                                                                                path: 'activeTourDetail>/estimate/LastUpdated',
                                                                                                formatter: '.formatDateTime'
                                                                                            }" class="sapUiTinyMarginBegin"/>
                                        </HBox>
                                    </VBox>
                                </Panel>
                            </VBox>
                        </ScrollContainer>
                    </IconTabFilter>
                </items>
            </IconTabBar>
        </content>
    </Page>
</mvc:View>
